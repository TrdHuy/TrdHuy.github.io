<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>GitHub File List</title>
     <style>
          table {
               width: 100%;
               border-collapse: collapse;
          }

          table,
          th,
          td {
               border: 1px solid black;
          }

          th,
          td {
               padding: 10px;
               text-align: left;
          }

          .modal {
               display: none;
               position: fixed;
               z-index: 1;
               left: 0;
               top: 0;
               width: 100%;
               height: 100%;
               overflow: auto;
               background-color: rgb(0, 0, 0);
               background-color: rgba(0, 0, 0, 0.4);
          }

          .modal-content {
               background-color: #fefefe;
               margin: 15% auto;
               padding: 20px;
               border: 1px solid #888;
               width: 80%;
          }

          .close {
               color: #aaa;
               float: right;
               font-size: 28px;
               font-weight: bold;
          }

          .close:hover,
          .close:focus {
               color: black;
               text-decoration: none;
               cursor: pointer;
          }
     </style>
</head>

<body>
     <button id="loadButton">Load Files</button>

     <div id="myModal" class="modal">
          <div class="modal-content">
               <span class="close">&times;</span>
               <label for="token">Token:</label>
               <input type="password" id="token" name="token">
               <button id="submitToken">OK</button>
          </div>
     </div>

     <table id="fileTable" style="display: none;">
          <thead>
               <tr>
                    <th>File Name</th>
                    <th>File Path</th>
               </tr>
          </thead>
          <tbody id="fileTableBody">
          </tbody>
     </table>

     <script>
          // Xóa dữ liệu sessionStorage khi trang được tải lại
          window.addEventListener('load', function () {
               sessionStorage.removeItem('githubFiles');
          });

          var modal = document.getElementById("myModal");
          var btn = document.getElementById("loadButton");
          var span = document.getElementsByClassName("close")[0];

          btn.onclick = function () {
               const cachedFiles = sessionStorage.getItem('githubFiles');

               if (cachedFiles) {
                    const files = JSON.parse(cachedFiles);
                    displayFiles(files);
               } else {
                    modal.style.display = "block";
               }
          }

          span.onclick = function () {
               modal.style.display = "none";
          }

          window.onclick = function (event) {
               if (event.target == modal) {
                    modal.style.display = "none";
               }
          }
          document.getElementById('submitToken').addEventListener('click', async function () {
               const token = document.getElementById('token').value;
               await loadFiles(token);
          });

          async function loadFiles(token) {
               const user = 'TrdHuy'; // Thay đổi bằng tên repo của bạn
               const repo = 'TrdHuy.github.io'; // Thay đổi bằng tên repo của bạn
               const folderPath = 'CoverageReport'; // Thay đổi bằng đường dẫn đến folder trong repo của bạn
               const branch = 'master'; // Thay đổi bằng đường dẫn đến folder trong repo của bạn
               const url = `https://api.github.com/repos/${user}/${repo}/git/trees/${branch}?recursive=1`;

               try {
                    const response = await fetch(url, {
                         headers: {
                              'Authorization': `token ${token}`
                         }
                    });

                    if (response.ok) {
                         const data = await response.json();
                         const files = data.tree.filter(item => item.type === 'blob' && item.path.endsWith('.html'));
                         sessionStorage.setItem('githubFiles', JSON.stringify(files));
                         displayFiles(files);
                         document.getElementById('myModal').style.display = 'none';
                    } else {
                         alert('Failed to fetch files. Please check your token and repo path.');
                    }
               } catch (error) {
                    console.error('Error fetching files:', error);
                    alert('An error occurred. Please try again.');
               }
          }
          function displayFiles(files) {
               const fileTableBody = document.getElementById('fileTableBody');
               fileTableBody.innerHTML = '';

               files.forEach(file => {
                    const row = document.createElement('tr');
                    const nameCell = document.createElement('td');
                    const pathCell = document.createElement('td');

                    // Tạo thẻ liên kết cho tên tệp
                    // const link = document.createElement('a');
                    // link.href = `https://github.com/TrdHuy/TrdHuy.github.io/${file.path}`;
                    // link.textContent = file.path.split('/').pop();
                    // link.target = '_blank'; // Mở liên kết trong tab mới
                    // nameCell.appendChild(link);
                    nameCell.textContent = file.path.split('/').pop(); // Lấy tên tệp
                    // Tạo thẻ liên kết cho đường dẫn tệp
                    const pathLink = document.createElement('a');
                    pathLink.href = `https://github.com/TrdHuy/TrdHuy.github.io/${file.path}`;
                    pathLink.textContent = file.path;
                    pathLink.target = '_blank'; // Mở liên kết trong tab mới
                    pathCell.appendChild(pathLink);

                    row.appendChild(nameCell);
                    row.appendChild(pathCell);
                    fileTableBody.appendChild(row);
               });

               document.getElementById('fileTable').style.display = 'table';
          }
     </script>
</body>

</html>